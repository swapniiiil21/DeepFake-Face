<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Deepfake Detector - AI-Powered Analysis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Define CSS variables for consistent theming */
        :root {
            /* Base Palette - Sophisticated Dark Theme */
            --bg-color-dark: #0D1117; /* Very dark blue/charcoal - like GitHub dark */
            --bg-color-medium: #161B22; /* Slightly lighter for layered elements */
            --bg-color-light: #21262D;  /* For cards or interactive surfaces */
            --bg-color-light-rgb: 33, 38, 45; /* Defined here for rgba usage in CSS */

            /* Accent Palette - Vibrant & Techy */
            --accent-primary: #58A6FF; /* Bright Blue - good for CTAs */
            --accent-secondary: #A371F7; /* Purple - for highlights or secondary actions */
            --accent-tertiary: #2EA043; /* Green - for success states (like 'Real' result) */
            --accent-danger: #F85149;   /* Red - for warning states (like 'Fake' result) */

            /* Text Palette */
            --text-primary: #C9D1D9;    /* Light gray for primary body text */
            --text-secondary: #8B949E;  /* Medium gray for secondary/less important text */
            --text-headings: #F0F6FC;   /* Brighter white/light gray for headings */
            --text-on-accent: #FFFFFF;  /* White text on accent-colored buttons */

            /* Border & Shadow */
            --border-color: rgba(139, 148, 158, 0.3); /* Subtle border color */
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); /* Deeper, more pronounced shadow */
            --glow-effect: 0 0 20px rgba(var(--accent-primary-rgb), 0.4); /* Stronger glow */

            /* UI Elements */
            --border-radius: 12px; /* Slightly more rounded for a modern feel */
            --transition-speed: 0.5s; /* Slightly slower for smoother transitions */
            --transition-easing: cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* Global reset and font styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji"; /* Apple-like font stack, prioritize Inter */
        }

        html {
            scroll-behavior: smooth; /* Smooth scrolling for anchor links */
        }

        body {
            background-color: var(--bg-color-dark);
            color: var(--text-primary);
            line-height: 1.7; /* Increased line height for readability */
            overflow-x: hidden; /* Prevent horizontal scroll */
            position: relative; /* For pseudo-elements */
        }

        /* Advanced Animated Gradient Background - More subtle and deep */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -2; /* Behind content and other potential layers */
            background: linear-gradient(
                -45deg,
                #0d1117, /* Deep base */
                #010409, /* Even deeper */
                #1c2a40, /* Muted blue */
                #2a1c40  /* Muted purple */
            );
            background-size: 400% 400%; /* Larger background for animation */
            animation: gradientBG 25s ease infinite; /* Smooth, infinite animation, slightly slower */
            filter: blur(8px); /* More subtle blur effect */
            opacity: 0.85; /* Slightly increased opacity */
        }

        /* Optional: Subtle pattern overlay for texture (like Stripe's subtle backgrounds) */
        body::after {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1; /* Above the gradient, below content */
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.04) 1px, transparent 0); /* Slightly more visible dots */
            background-size: 25px 25px; /* Adjust for dot density */
            opacity: 0.6; /* Slightly increased opacity */
        }

        /* Keyframe animation for the background gradient */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Link styling */
        a {
            text-decoration: none;
            color: var(--accent-primary);
            font-weight: 500;
            transition: color var(--transition-speed) var(--transition-easing);
        }
        a:hover {
            color: var(--text-headings); /* Brighter on hover */
            filter: brightness(1.2); /* More noticeable brightness */
        }

        ul { list-style: none; } /* Remove bullet points from lists */

        /* Container for content width limitation */
        .container {
            max-width: 1120px; /* Slightly wider for more expansive content */
            margin: 0 auto;
            padding: 0 25px; /* Increased horizontal padding */
        }

        /* Button styling */
        .btn {
            display: inline-block;
            padding: 14px 32px; /* Increased padding for larger touch targets */
            background: var(--accent-primary);
            color: var(--text-on-accent);
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: all var(--transition-speed) var(--transition-easing);
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4), var(--glow-effect); /* Stronger shadow */
            text-transform: none;
            letter-spacing: 0.7px; /* Slightly more letter spacing */
            font-size: 1.05rem; /* Slightly larger font */
        }

        .btn:hover {
            transform: translateY(-4px) scale(1.04); /* More pronounced lift and enlarge on hover */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5), 0 0 30px rgba(var(--accent-primary-rgb), 0.6); /* Stronger glow on hover */
            filter: brightness(1.15);
        }

        /* Outline button variant */
        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent-primary);
            color: var(--accent-primary);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: var(--accent-primary);
            color: var(--text-on-accent);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4), var(--glow-effect);
        }

        /* Section general styling */
        section {
            padding: 100px 0; /* Increased vertical padding for sections */
            overflow: hidden;
            position: relative;
        }

        /* Section title styling */
        .section-title {
            text-align: center;
            margin-bottom: 35px; /* Increased margin */
            font-size: 3rem; /* Larger for impact */
            color: var(--text-headings);
            font-weight: 700;
            line-height: 1.2;
            letter-spacing: -1px; /* Tighter letter spacing for headings */
            text-shadow: 0 3px 15px rgba(0,0,0,0.4); /* More pronounced text shadow */
        }

        /* Section subtitle styling */
        .section-subtitle {
            text-align: center;
            max-width: 750px; /* Slightly wider */
            margin: 0 auto 60px; /* Increased margin */
            color: var(--text-secondary);
            font-size: 1.15rem; /* Slightly larger font */
            line-height: 1.7;
        }

        /* Header Styles */
        header {
            background-color: rgba(13, 17, 23, 0.9); /* Slightly less transparent */
            backdrop-filter: blur(15px); /* More pronounced blur */
            box-shadow: 0 2px 0 rgba(139, 148, 158, 0.15); /* More visible bottom line */
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0; /* Adjusted padding */
        }

        .logo {
            font-size: 1.8rem; /* Slightly larger logo */
            font-weight: 700;
            color: var(--text-headings);
            display: flex;
            align-items: center;
        }
        .logo i {
            margin-right: 12px; /* Increased margin */
            color: var(--accent-primary);
        }

        nav ul { display: flex; }
        nav ul li { margin-left: 35px; /* Increased spacing between nav items */ }
        nav ul li a {
            font-weight: 500;
            font-size: 1rem; /* Slightly larger for better readability */
            color: var(--text-secondary);
            padding: 10px 12px; /* Increased padding */
            border-radius: 8px; /* More rounded */
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        nav ul li a:hover,
        nav ul li a.active-link {
            color: var(--text-headings);
            background-color: rgba(var(--accent-primary-rgb), 0.15); /* More visible hover background */
        }

        .mobile-menu-btn {
            display: none; /* Hidden by default on desktop */
            font-size: 2rem; /* Larger icon */
            cursor: pointer;
            color: var(--text-headings);
        }

        /* Hero Section */
        .hero {
            min-height: 95vh; /* Slightly taller hero section */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding-top: 140px; /* More space for fixed header */
            padding-bottom: 80px;
            background: transparent; /* Rely on body pseudo-elements */
            position: relative;
            overflow: visible; /* Allow for potential overflow effects */
        }
        /* Optional: Add a subtle radial gradient behind hero content for focus */
        .hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 90%; /* Larger gradient */
            height: 90%; /* Larger gradient */
            transform: translate(-50%, -50%);
            background: radial-gradient(ellipse at center, rgba(var(--accent-primary-rgb), 0.12) 0%, transparent 60%); /* Stronger, wider gradient */
            z-index: 0;
            pointer-events: none;
        }

        .hero-content { z-index: 1; }
        .hero h1 {
            font-size: 4.5rem; /* Even larger for maximum impact */
            margin-bottom: 25px; /* Increased margin */
            color: var(--text-headings);
            font-weight: 800; /* Bolder */
            line-height: 1.05; /* Tighter line height */
            letter-spacing: -1.5px; /* Tighter letter spacing */
            text-shadow: 0 4px 20px rgba(0,0,0,0.5); /* More prominent text shadow */
        }
        .hero p {
            font-size: 1.3rem; /* Larger paragraph text */
            max-width: 700px; /* Wider paragraph */
            margin: 0 auto 50px; /* Increased margin */
            color: var(--text-secondary);
        }
        .hero-buttons { display: flex; justify-content: center; gap: 25px; /* Increased gap */ }


        /* Detection Section */
        #detection { background-color: transparent; }
        .detection-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(var(--bg-color-light-rgb), 0.9); /* Less transparent, more solid */
            backdrop-filter: blur(12px); /* Stronger blur */
            border-radius: var(--border-radius);
            padding: 50px; /* Increased padding */
            box-shadow: var(--card-shadow);
            max-width: 800px; /* Wider container */
            margin: 0 auto;
            border: 1px solid var(--border-color);
        }

        .upload-area {
            width: 100%;
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 55px; /* More padding */
            text-align: center;
            margin-bottom: 35px; /* Increased margin */
            cursor: pointer;
            transition: all 0.3s var(--transition-easing);
            color: var(--text-secondary);
        }
        .upload-area:hover, .upload-area.active-drag {
            border-color: var(--accent-primary);
            background-color: rgba(var(--accent-primary-rgb), 0.08); /* More visible hover background */
            transform: scale(1.02);
        }
        .upload-area i {
            font-size: 3.5rem; /* Larger icon */
            color: var(--accent-primary);
            margin-bottom: 18px; /* Increased margin */
        }
        .upload-area p { margin-bottom: 12px; font-size: 1.1rem; color: var(--text-primary); } /* Larger text */
        .upload-area small { color: var(--text-secondary); font-size: 0.95rem; } /* Slightly larger small text */
        #fileInput { display: none; } /* Hidden file input */

        .image-preview {
            position: relative; /* For canvas overlay */
            width: 100%;
            max-width: 450px; /* Slightly larger preview */
            margin: 0 auto 35px; /* Increased margin */
            display: none; /* Hidden by default */
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3); /* Stronger shadow */
            border: 1px solid var(--border-color);
        }
        .image-preview img {
            width: 100%;
            display: block;
        }
        /* Canvas for drawing detections (not used with Gemini API directly for face detection) */
        .image-preview canvas {
            display: none; /* Hide canvas if not used for drawing detections */
        }

        #analyzeBtn { display: none; margin-bottom: 30px;} /* Increased margin */

        .result-container {
            text-align: center;
            margin-top: 35px; /* Increased margin */
            width: 100%;
            display: none; /* Hidden by default */
        }
        .result-box {
            padding: 20px; /* More padding */
            border-radius: var(--border-radius);
            font-size: 1.25rem; /* Larger font */
            font-weight: 600;
            margin-bottom: 25px; /* Increased margin */
            transition: background-color 0.3s ease, color 0.3s ease;
            color: var(--text-on-accent);
        }
        .result-box.real { background-color: var(--accent-tertiary); } /* Green for real */
        .result-box.fake { background-color: var(--accent-danger); } /* Red for fake */

        .confidence-meter {
            width: 100%; height: 14px; /* Slightly taller progress bar */
            background-color: var(--bg-color-medium);
            border-radius: 14px; margin: 25px 0; overflow: hidden; /* Increased margin and radius */
            border: 1px solid var(--border-color);
        }
        .confidence-level {
            height: 100%;
            width: 0%; /* Set by JS to show progress */
            transition: width 1s var(--transition-easing), background-color 0.3s ease; /* Slower transition */
            border-radius: 14px;
        }
        .confidence-value {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.05rem; /* Slightly larger */
        }
        #resultExplanation { color: var(--text-secondary); margin-top: 15px; font-size: 0.95rem; line-height: 1.6;} /* Adjusted */

        /* LLM Insights Section */
        #llmInsightsContainer {
            margin-top: 40px; /* More space */
            padding: 25px; /* More padding */
            background-color: var(--bg-color-medium);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            text-align: left;
            /* display: none; */ /* Managed by JS */
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); /* Subtle shadow */
        }
        #llmInsightsContainer h4 {
            color: var(--text-headings);
            font-size: 1.3rem; /* Larger heading */
            margin-bottom: 20px; /* More margin */
            text-align: center;
            font-weight: 600;
        }
        #llmInsightsContent {
            color: var(--text-primary);
            font-size: 1rem; /* Slightly larger text */
            line-height: 1.8; /* Increased line height for readability */
            white-space: pre-wrap; /* Preserve whitespace and line breaks */
        }
        #llmInsightsLoading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--accent-primary);
            font-size: 1.1rem;
            font-weight: 500;
            padding: 25px;
        }

        /* Loading Indicator */
        .loading-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 25px; /* Increased margin */
            color: var(--accent-primary);
            font-size: 1.15rem; /* Slightly larger text */
            font-weight: 500;
        }

        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3); /* Thicker border */
            border-top: 5px solid var(--accent-primary); /* Thicker border */
            border-radius: 50%;
            width: 35px; /* Larger spinner */
            height: 35px; /* Larger spinner */
            animation: spin 0.9s linear infinite; /* Slightly faster spin */
            margin-bottom: 12px; /* Increased margin */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Features Section - Glassmorphism Cards */
        #features { background-color: transparent; }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Slightly wider min-width */
            gap: 35px; /* Increased gap */
        }
        .feature-card {
            background-color: rgba(var(--bg-color-light-rgb), 0.8); /* Less transparent, more solid */
            backdrop-filter: blur(15px); /* Stronger blur */
            border-radius: var(--border-radius);
            padding: 35px; /* Increased padding */
            box-shadow: var(--card-shadow);
            text-align: left;
            transition: transform var(--transition-speed) var(--transition-easing), box-shadow var(--transition-speed) var(--transition-easing), background-color var(--transition-speed) var(--transition-speed);
            border: 1px solid var(--border-color);
        }
        .feature-card:hover {
            transform: translateY(-10px) scale(1.03); /* More pronounced lift and enlarge */
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6), 0 0 25px rgba(var(--accent-secondary-rgb), 0.4); /* Stronger shadow and glow */
            background-color: rgba(var(--bg-color-light-rgb), 0.9); /* More solid on hover */
        }
        .feature-icon {
            font-size: 3rem; /* Larger icon */
            color: var(--accent-secondary); /* Using secondary accent for features */
            margin-bottom: 22px; /* Increased margin */
            display: inline-block;
        }
        .feature-title {
            font-size: 1.45rem; /* Larger title */
            margin-bottom: 15px; /* Increased margin */
            color: var(--text-headings);
            font-weight: 600;
        }
        .feature-card p {
            color: var(--text-secondary);
            font-size: 0.95rem; /* Slightly larger text */
            line-height: 1.7;
        }

        /* How It Works Section */
        #how-it-works { background-color: var(--bg-color-medium); padding: 100px 0; } /* Solid section bg for contrast, consistent padding */
        .steps-container {
            display: flex;
            justify-content: center; /* Center items */
            margin-top: 60px; /* Increased margin */
            flex-wrap: wrap;
            gap: 30px; /* Increased gap */
        }
        .step {
            flex-basis: 23%; /* Adjusted for better distribution */
            min-width: 250px; /* Increased min-width */
            text-align: left;
            padding: 30px; /* Increased padding */
            background-color: var(--bg-color-light);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 6px 15px rgba(0,0,0,0.25); /* Stronger shadow */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .step:hover {
            transform: translateY(-8px); /* More pronounced lift */
            box-shadow: 0 10px 20px rgba(0,0,0,0.4); /* Stronger shadow */
        }
        .step-number {
            width: 50px; height: 50px; /* Larger number circle */
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--text-on-accent); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.6rem; font-weight: bold; /* Larger font */
            margin-bottom: 25px; /* Increased margin */
            box-shadow: 0 4px 10px rgba(0,0,0,0.35); /* Stronger shadow */
        }
        .step-title {
            font-size: 1.35rem; /* Larger title */
            margin-bottom: 12px;
            color: var(--text-headings);
            font-weight: 600;
        }
        .step p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.7;
        }

        /* Testimonials Section */
        #testimonials { background-color: transparent; }
        .testimonials-container {
            display: flex;
            overflow-x: auto; /* Enable horizontal scrolling */
            gap: 30px; /* Increased gap */
            padding: 25px 10px; /* More padding */
            scroll-snap-type: x mandatory; /* Snap to cards when scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        .testimonial-card {
            min-width: 350px; /* Wider cards */
            background-color: rgba(var(--bg-color-light-rgb), 0.8); /* Less transparent */
            backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            padding: 30px; /* Increased padding */
            box-shadow: var(--card-shadow);
            scroll-snap-align: center;
            border: 1px solid var(--border-color);
        }
        .testimonial-text {
            font-style: italic;
            margin-bottom: 25px; /* Increased margin */
            color: var(--text-primary);
            font-size: 1.05rem; /* Slightly larger text */
            line-height: 1.7;
        }
        .testimonial-author { display: flex; align-items: center; }
        .author-avatar {
            width: 52px; height: 52px; /* Larger avatar */
            border-radius: 50%;
            margin-right: 18px; overflow: hidden; /* Increased margin */
            border: 3px solid var(--accent-primary); /* Thicker border */
        }
        .author-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .author-info h4 {
            color: var(--text-headings);
            margin-bottom: 5px;
            font-size: 1.1rem; /* Slightly larger */
            font-weight: 600;
        }
        .author-info p {
            color: var(--text-secondary);
            font-size: 0.85rem; /* Slightly larger */
        }

        /* FAQ Section */
        #faq { background-color: var(--bg-color-medium); padding: 100px 0; } /* Solid section bg, consistent padding */
        .faq-container { max-width: 850px; margin: 0 auto; } /* Wider container */
        .faq-item {
            background-color: var(--bg-color-light);
            border-radius: var(--border-radius);
            margin-bottom: 20px; /* Increased margin */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25); /* Stronger shadow */
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .faq-question {
            padding: 20px 25px; display: flex; justify-content: space-between; /* Increased padding */
            align-items: center; cursor: pointer; font-weight: 600;
            color: var(--text-headings);
            font-size: 1.15rem; /* Slightly larger */
        }
        .faq-question i {
            transition: transform 0.3s var(--transition-easing);
            color: var(--accent-primary);
        }
        .faq-answer {
            padding: 0 25px; max-height: 0; /* Hidden by default, increased horizontal padding */
            overflow: hidden; transition: max-height 0.5s var(--transition-easing), padding 0.5s var(--transition-easing); /* Slower transition */
            color: var(--text-secondary);
            font-size: 0.95rem; /* Slightly larger */
            line-height: 1.7;
        }
        .faq-item.active .faq-question i { transform: rotate(180deg); } /* Rotate icon when active */
        .faq-item.active .faq-answer { max-height: 500px; padding-bottom: 25px; } /* Expand answer, increased padding */

        /* CTA Section */
        .cta { background: transparent; text-align: center; padding: 100px 0; } /* Consistent padding */
        .cta h2 {
            font-size: 2.8rem; /* Larger heading */
            margin-bottom: 25px; /* Increased margin */
            color: var(--text-headings);
            font-weight: 700;
            line-height: 1.2;
        }
        .cta p {
            max-width: 700px; /* Wider paragraph */
            margin: 0 auto 50px; /* Increased margin */
            font-size: 1.15rem; /* Slightly larger text */
            color: var(--text-secondary);
        }

        /* Footer */
        footer {
            background-color: var(--bg-color-dark); /* Darkest bg for footer */
            color: var(--text-secondary);
            padding: 70px 0 25px; /* Increased padding */
            border-top: 1px solid var(--border-color);
        }
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); /* Slightly wider min-width */
            gap: 40px; margin-bottom: 50px; /* Increased gap and margin */
        }
        .footer-logo {
            font-size: 1.8rem; /* Larger logo */
            font-weight: 700;
            color: var(--text-headings);
            margin-bottom: 25px; /* Increased margin */
            display: inline-block;
        }
         .footer-logo i { margin-right: 10px; color: var(--accent-primary);}

        .footer-about p {
            margin-bottom: 25px; /* Increased margin */
            font-size: 0.95rem; /* Slightly larger text */
            line-height: 1.7;
        }
        .social-links { display: flex; gap: 18px; /* Increased gap */ }
        .social-links a {
            width: 42px; height: 42px; /* Larger icons */
            border-radius: 50%;
            background-color: var(--bg-color-light);
            display: flex; align-items: center; justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.3s ease;
            color: var(--text-secondary);
            font-size: 1rem; /* Larger icon size */
        }
        .social-links a:hover {
            background-color: var(--accent-primary);
            color: var(--text-on-accent);
            transform: scale(1.15); /* More pronounced scale */
        }
        .footer-links h3 {
            font-size: 1.2rem; /* Larger heading */
            margin-bottom: 20px; /* Increased margin */
            color: var(--text-headings);
            font-weight: 600;
        }
        .footer-links ul li { margin-bottom: 12px; /* Increased margin */ }
        .footer-links ul li a {
            color: var(--text-secondary);
            transition: color 0.3s ease;
            font-size: 0.95rem; /* Slightly larger text */
        }
        .footer-links ul li a:hover { color: var(--accent-primary); }
        .footer-contact p {
            margin-bottom: 12px; /* Increased margin */
            font-size: 0.95rem; /* Slightly larger text */
            line-height: 1.7;
        }
        .footer-bottom {
            text-align: center; padding-top: 25px; /* Increased padding */
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem; /* Slightly larger text */
        }

        /* Scroll Animations - Subtle Fade In Up */
        .scroll-animate {
            opacity: 0;
            transform: translateY(30px); /* More pronounced initial translateY */
            transition: opacity 0.8s var(--transition-easing), transform 0.8s var(--transition-easing); /* Slower transition */
        }
        .scroll-animate.visible {
            opacity: 1;
            transform: translateY(0);
        }


        /* Responsive Styles */
        @media (max-width: 992px) {
            .hero h1 { font-size: 3.8rem; }
            .section-title { font-size: 2.8rem; }
            .steps-container { justify-content: center; }
            .step { flex-basis: 48%; min-width: 280px; } /* Adjusted for two columns */
            .features-grid { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        }

        @media (max-width: 768px) {
            .header-container { padding: 18px 0; }
            nav {
                position: fixed;
                top: 75px; /* Adjusted to be below the header */
                left: 0;
                width: 100%;
                background-color: rgba(22, 27, 34, 0.98); /* Darker mobile nav */
                backdrop-filter: blur(15px);
                padding: 25px; /* Increased padding */
                box-shadow: 0 8px 20px rgba(0,0,0,0.4);
                transform: translateY(-150%); /* Start off-screen */
                transition: transform 0.5s ease-in-out; /* Slower transition */
                border-bottom: 1px solid var(--border-color);
                height: calc(100vh - 75px); /* Fill remaining viewport height */
                overflow-y: auto; /* Enable scrolling for many links */
            }
            nav.active { transform: translateY(0); } /* Slide in when active */
            nav ul { flex-direction: column; align-items: center; }
            nav ul li { margin: 15px 0; } /* Increased margin */
            nav ul li a { font-size: 1.1rem; color: var(--text-primary); }
            nav ul li a:hover, nav ul li a.active-link {
                background-color: var(--accent-primary);
                color: var(--text-on-accent);
            }
            .mobile-menu-btn { display: block; } /* Show menu button on mobile */

            .hero h1 { font-size: 3.2rem; }
            .hero p { font-size: 1.2rem; }
            .hero-buttons { flex-direction: column; align-items: center; gap: 20px; }
            .btn { padding: 14px 28px; width: 80%; max-width: 320px; text-align: center;} /* Wider buttons */

            .section-title { font-size: 2.5rem; }
            .detection-container { padding: 35px; } /* Adjusted padding */
            .upload-area { padding: 40px 20px; } /* Adjusted padding */
            .step { flex-basis: 90%; } /* Single column for steps on smaller tablets */
            .features-grid { grid-template-columns: 1fr; } /* Single column for features */
            .testimonials-container { padding: 25px 0; } /* Adjusted padding */
            .testimonial-card { min-width: 90%; } /* Adjust width for better fit */
        }

        @media (max-width: 576px) {
            .hero { padding: 120px 0 70px; min-height: 80vh;} /* Adjusted padding and min-height */
            .hero h1 { font-size: 2.6rem; letter-spacing: -1px; } /* Adjusted font size and spacing */
            .hero p { font-size: 1.1rem; }
            section { padding: 60px 0; } /* Adjusted padding */
            .section-title { font-size: 2.2rem; letter-spacing: -0.8px; } /* Adjusted font size and spacing */
            .section-subtitle { font-size: 1.05rem; margin-bottom: 40px; }
            .footer-grid { grid-template-columns: 1fr; text-align:center;} /* Single column for footer on mobile */
            .social-links { justify-content: center;}
            .footer-logo { display: block; margin-left: auto; margin-right: auto;}
            .btn { width: 90%; max-width: 300px; } /* Even wider buttons */
        }
    </style>
</head>
<body>
    <header id="pageHeader">
        <div class="container header-container">
            <a href="#" class="logo scroll-animate">
                <i class="fas fa-eye"></i>Deepfake Detector
            </a>
            <nav id="mainNav">
                <ul>
                    <li><a href="#hero" class="active-link">Home</a></li>
                    <li><a href="#detection">Try Detector</a></li>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#faq">FAQ</a></li>
                </ul>
            </nav>
            <div class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>

    <section class="hero" id="hero">
        <div class="hero-content container">
            <h1 class="scroll-animate">Unveil the Truth in Pixels.</h1>
            <p class="scroll-animate" data-delay="200">Harnessing advanced AI to discern authentic visuals from sophisticated deepfakes. Secure your digital reality.</p>
            <div class="hero-buttons scroll-animate" data-delay="400">
                <a href="#detection" class="btn">Analyze Image Now</a>
                <a href="#features" class="btn btn-outline">Explore Features</a>
            </div>
        </div>
    </section>

    <section id="detection" class="scroll-animate">
        <div class="container">
            <h2 class="section-title">AI Deepfake Detection</h2>
            <p class="section-subtitle">Upload an image (JPG, PNG, max 5MB). Our AI meticulously analyzes for manipulation signatures.</p>
            <div class="detection-container">
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag & Drop Your Image or Click to Upload</p>
                    <small>Privacy Assured: Images are processed and not stored.</small>
                    <input type="file" id="fileInput" accept="image/jpeg, image/png">
                </div>
                <div class="image-preview" id="imagePreview">
                    <img id="previewImage" src="#" alt="Uploaded Image Preview">
                    <!-- Canvas for drawing detections is no longer needed as Gemini API handles analysis conceptually -->
                    <!-- <canvas id="overlayCanvas"></canvas> -->
                </div>
                <button class="btn" id="analyzeBtn">Initiate Analysis</button>

                <!-- Loading Indicator HTML -->
                <div class="loading-indicator" id="loadingIndicator" style="display: none;">
                    <div class="spinner"></div>
                    <p>Sending image to AI for comprehensive analysis...</p>
                </div>

                <div class="result-container" id="resultContainer">
                    <div class="result-box" id="resultBox">Awaiting Analysis...</div>
                    <div class="confidence-meter">
                        <div class="confidence-level" id="confidenceLevel"></div>
                    </div>
                    <div class="confidence-value" id="confidenceValue">Confidence: --%</div>
                    <p id="resultExplanation">The AI's detailed findings will appear here.</p>
                    <button class="btn" id="downloadReportBtn" style="margin-top: 25px; display: none;">Download Analysis Report</button>
                    <div id="llmInsightsContainer" style="margin-top: 25px; display: none;">
                        <h4>Deepfake Insights from AI</h4>
                        <div id="llmInsightsContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="features">
        <div class="container">
            <h2 class="section-title scroll-animate">Core Technology Features</h2>
            <p class="section-subtitle scroll-animate" data-delay="100">Experience the next generation of digital media verification, built for precision and trust.</p>
            <div class="features-grid">
                <div class="feature-card scroll-animate" data-delay="200">
                    <div class="feature-icon"><i class="fas fa-brain"></i></div>
                    <h3 class="feature-title">Neural Network Precision</h3>
                    <p>Leverages state-of-the-art deep learning models to identify subtle, AI-generated artifacts often missed by human eyes.</p>
                </div>
                <div class="feature-card scroll-animate" data-delay="300">
                    <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                    <h3 class="feature-title">Zero-Knowledge Analysis</h3>
                    <p>Client-side processing ensures your images are analyzed without leaving your device, guaranteeing utmost privacy.</p>
                </div>
                <div class="feature-card scroll-animate" data-delay="400">
                    <div class="feature-icon"><i class="fas fa-bolt"></i></div>
                    <h3 class="feature-title">Real-Time Feedback</h3>
                    <p>Our optimized algorithms deliver rapid analysis, providing you with actionable insights in seconds.</p>
                </div>
                <div class="feature-card scroll-animate" data-delay="200">
                    <div class="feature-icon"><i class="fas fa-chart-pie"></i></div>
                    <h3 class="feature-title">Transparent Confidence</h3>
                    <p>Receive a clear, interpretable confidence score, along with explanations of potential manipulation indicators.</p>
                </div>
                   <div class="feature-card scroll-animate" data-delay="300">
                    <div class="feature-icon"><i class="fas fa-cogs"></i></div> <h3 class="feature-title">Adaptive Algorithms</h3>
                    <p>Our (conceptual) AI models are continuously updated to recognize and counter evolving deepfake generation techniques.</p>
                </div>
                   <div class="feature-card scroll-animate" data-delay="400">
                    <div class="feature-icon"><i class="fas fa-microscope"></i></div>
                    <h3 class="feature-title">Forensic-Grade Detail</h3>
                    <p>Designed to scrutinize images at a granular level, detecting inconsistencies in lighting, shadows, and textures.</p>
                </div>
            </div>
        </div>
    </section>

      <section id="how-it-works">
        <div class="container">
            <h2 class="section-title scroll-animate">The Detection Process</h2>
            <p class="section-subtitle scroll-animate" data-delay="100">A streamlined, four-step approach to verifying digital media authenticity.</p>
            <div class="steps-container">
                <div class="step scroll-animate" data-delay="200">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Secure Upload</h3>
                    <p>Select your image. It's prepared for analysis within your browser's secure environment.</p>
                </div>
                <div class="step scroll-animate" data-delay="300">
                    <div class="step-number">2</div>
                    <h3 class="step-title">AI-Powered Scan</h3>
                    <p>Our advanced AI (via Gemini API) scans for digital fingerprints, compression anomalies, and GAN-specific patterns across the entire image.</p>
                </div>
                <div class="step scroll-animate" data-delay="400">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Comprehensive Analysis</h3>
                    <p>The AI provides a detailed report on faces, background, lighting, and other subtle inconsistencies.</p>
                </div>
                <div class="step scroll-animate" data-delay="500">
                    <div class="step-number">4</div>
                    <h3 class="step-title">Integrity Report & Download</h3>
                    <p>A verdict, confidence score, and a downloadable detailed report are presented clearly.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="testimonials" class="scroll-animate">
        <div class="container">
            <h2 class="section-title">Trusted Voices. Real Impact.</h2>
            <p class="section-subtitle">Hear from individuals and organizations benefiting from enhanced media verification.</p>
            <div class="testimonials-container">
                <div class="testimonial-card">
                    <p class="testimonial-text">"In my line of work, distinguishing real from fake is critical. This tool is incredibly precise and has become an indispensable asset."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar"><img src="https://via.placeholder.com/48/58A6FF/FFFFFF?text=JD" alt="John Doe"></div>
                        <div class="author-info">
                            <h4>John D.</h4>
                            <p>Investigative Journalist</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <p class="testimonial-text">"As a content creator, maintaining authenticity is key. This detector gives me confidence in the media I share."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar"><img src="https://via.placeholder.com/48/A371F7/FFFFFF?text=AS" alt="Alice Smith"></div>
                        <div class="author-info">
                            <h4>Alice S.</h4>
                            <p>Digital Media Specialist</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <p class="testimonial-text">"The rise of deepfakes is alarming. Tools like this are essential for anyone concerned about digital truth and security."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar"><img src="https://via.placeholder.com/48/2EA043/FFFFFF?text=MJ" alt="Michael Johnson"></div>
                        <div class="author-info">
                            <h4>Michael J.</h4>
                            <p>Cybersecurity Analyst</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <p class="testimonial-text">"Fast, reliable, and easy to use. This deepfake detector is exactly what the internet needs right now."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar"><img src="https://via.placeholder.com/48/F85149/FFFFFF?text=EM" alt="Emily White"></div>
                        <div class="author-info">
                            <h4>Emily W.</h4>
                            <p>Social Media Researcher</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="faq">
        <div class="container">
            <h2 class="section-title scroll-animate">Frequently Asked Questions</h2>
            <p class="section-subtitle scroll-animate" data-delay="100">Quick answers to common inquiries about deepfakes and our detection technology.</p>
            <div class="faq-container">
                <div class="faq-item scroll-animate" data-delay="200">
                    <div class="faq-question">
                        What is a deepfake? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>A deepfake is a synthetic media in which a person in an existing image or video is replaced with someone else's likeness using artificial intelligence. This technology can create highly convincing, yet entirely fabricated, content.</p>
                    </div>
                </div>
                <div class="faq-item scroll-animate" data-delay="300">
                    <div class="faq-question">
                        How does your AI detect deepfakes? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Our AI (via Gemini API) uses advanced large language models to analyze images for subtle inconsistencies, artifacts, and patterns characteristic of AI-generated content. It examines facial features, background elements, lighting, and overall image cohesion to provide a comprehensive analysis.</p>
                    </div>
                </div>
                <div class="faq-item scroll-animate" data-delay="400">
                    <div class="faq-question">
                        Is my uploaded image stored or shared? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>No. We prioritize your privacy. Images uploaded to the detector are sent to the Gemini API for analysis and are not stored on any servers or shared with any third parties beyond the immediate API call.</p>
                    </div>
                </div>
                <div class="faq-item scroll-animate" data-delay="500">
                    <div class="faq-question">
                        What image formats are supported? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Currently, our detector supports common image formats such as JPG (JPEG) and PNG. We recommend images be under 5MB for optimal API performance.</p>
                    </div>
                </div>
                <div class="faq-item scroll-animate" data-delay="600">
                    <div class="faq-question">
                        How accurate is the deepfake detection? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Our AI models are continuously updated and designed to be highly effective. While no detection method is 100% foolproof due to the evolving nature of deepfake technology, our goal is to provide a robust and reliable indicator based on the comprehensive analysis by the Gemini API.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta scroll-animate">
        <div class="container">
            <h2>Ready to Verify Digital Authenticity?</h2>
            <p>Upload an image now and let our AI provide clarity. Stay ahead in the fight against misinformation.</p>
            <a href="#detection" class="btn">Start Deepfake Scan</a>
        </div>
    </section>

    <footer>
        <div class="container footer-grid">
            <div class="footer-about">
                <a href="#" class="footer-logo">
                    <i class="fas fa-eye"></i>Deepfake Detector
                </a>
                <p>Empowering you with AI-driven insights to distinguish real from fabricated digital media.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#"><i class="fab fa-github"></i></a>
                    <a href="#"><i class="fab fa-discord"></i></a>
                </div>
            </div>
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#hero">Home</a></li>
                    <li><a href="#detection">Try Detector</a></li>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#faq">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h3>Resources</h3>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Support</a></li>
                    <li><a href="#">Blog</a></li>
                </ul>
            </div>
            <div class="footer-links footer-contact">
                <h3>Contact Us</h3>
                <p>Email: info@deepfakedetector.com</p>
                <p>Phone: +1 (555) 123-4567</p>
                <p>Address: 123 AI Lane, Tech City, TX 78701</p>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 Deepfake Detector. All rights reserved.
        </div>
    </footer>

    <script>
        // Custom Message Box Function (replaces alert())
        function displayMessageBox(title, message) {
            const messageBox = document.createElement('div');
            messageBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: var(--bg-color-light);
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
                box-shadow: var(--card-shadow);
                padding: 25px;
                z-index: 10000;
                max-width: 400px;
                width: 90%;
                text-align: center;
                color: var(--text-primary);
            `;
            messageBox.innerHTML = `
                <h4 style="color: var(--text-headings); margin-bottom: 15px;">${title}</h4>
                <p style="margin-bottom: 20px;">${message}</p>
                <button class="btn" style="padding: 8px 15px; font-size: 0.9rem;">OK</button>
            `;
            document.body.appendChild(messageBox);

            messageBox.querySelector('.btn').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }

        // Global variable to store the full analysis report for download
        let fullAnalysisReport = '';

        // Ensure the DOM is fully loaded before running JavaScript
        window.onload = async () => {
            try {
                // Get references to all necessary DOM elements
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                const imagePreview = document.getElementById('imagePreview');
                const previewImage = document.getElementById('previewImage');
                const analyzeBtn = document.getElementById('analyzeBtn');
                const resultContainer = document.getElementById('resultContainer');
                const resultBox = document.getElementById('resultBox');
                const confidenceLevel = document.getElementById('confidenceLevel');
                const confidenceValue = document.getElementById('confidenceValue');
                const resultExplanation = document.getElementById('resultExplanation');
                const loadingIndicator = document.getElementById('loadingIndicator');
                const downloadReportBtn = document.getElementById('downloadReportBtn'); // New download button
                const llmInsightsContainer = document.getElementById('llmInsightsContainer');
                const llmInsightsContent = document.getElementById('llmInsightsContent');
                const pageHeader = document.getElementById('pageHeader');
                const mainNav = document.getElementById('mainNav');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                const navLinks = document.querySelectorAll('#mainNav ul li a');

                let uploadedFile = null; // Variable to store the file selected by the user
                let uploadedImageBase64 = null; // To store base64 string for LLM

                // --- Header Scroll Effect ---
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 0) {
                        pageHeader.style.backgroundColor = 'rgba(13, 17, 23, 0.95)';
                        pageHeader.style.boxShadow = '0 2px 10px rgba(0,0,0,0.3)';
                    } else {
                        pageHeader.style.backgroundColor = 'rgba(13, 17, 23, 0.85)';
                        pageHeader.style.boxShadow = '0 1px 0 rgba(139, 148, 158, 0.1)';
                    }
                });

                // --- Mobile Menu Toggle ---
                mobileMenuBtn.addEventListener('click', () => {
                    mainNav.classList.toggle('active');
                    mobileMenuBtn.querySelector('i').classList.toggle('fa-bars');
                    mobileMenuBtn.querySelector('i').classList.toggle('fa-times');
                });

                // --- Close Mobile Menu on Link Click ---
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        mainNav.classList.remove('active');
                        mobileMenuBtn.querySelector('i').classList.remove('fa-times');
                        mobileMenuBtn.querySelector('i').classList.add('fa-bars');
                    });
                });

                // --- Smooth Scrolling for Navigation Links ---
                navLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.querySelector(this.getAttribute('href')).scrollIntoView({
                            behavior: 'smooth'
                        });
                        navLinks.forEach(item => item.classList.remove('active-link'));
                        this.classList.add('active-link');
                    });
                });

                // --- Scroll Animations (Fade In Up) ---
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const delay = parseInt(entry.target.dataset.delay) || 0;
                            setTimeout(() => {
                                entry.target.classList.add('visible');
                            }, delay);
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });

                document.querySelectorAll('.scroll-animate').forEach(element => {
                    observer.observe(element);
                });

                // --- FAQ Accordion Functionality ---
                document.querySelectorAll('.faq-question').forEach(question => {
                    question.addEventListener('click', () => {
                        const faqItem = question.closest('.faq-item');
                        faqItem.classList.toggle('active');
                        const answer = faqItem.querySelector('.faq-answer');
                        if (faqItem.classList.contains('active')) {
                            answer.style.maxHeight = answer.scrollHeight + "px";
                        } else {
                            answer.style.maxHeight = "0";
                        }
                    });
                });

                // --- Deepfake Detection Logic (Gemini API based) ---

                // Helper function to reset the detection area UI to its initial state
                function resetDetectionUI() {
                    imagePreview.style.display = 'none';
                    previewImage.src = '#';
                    analyzeBtn.style.display = 'none';
                    resultContainer.style.display = 'none';
                    loadingIndicator.style.display = 'none';
                    downloadReportBtn.style.display = 'none'; // Hide download button
                    llmInsightsContainer.style.display = 'none'; // Hide LLM insights container
                    llmInsightsContent.innerHTML = ''; // Clear LLM content
                    resultBox.textContent = 'Awaiting Analysis...';
                    resultBox.className = 'result-box';
                    confidenceLevel.style.width = '0%';
                    confidenceLevel.style.backgroundColor = '';
                    confidenceValue.textContent = 'Confidence: --%';
                    resultExplanation.textContent = "The AI's detailed findings will appear here.";
                    uploadArea.classList.remove('active-drag');
                    fileInput.value = '';
                    uploadedFile = null;
                    uploadedImageBase64 = null; // Clear base64 data
                    fullAnalysisReport = ''; // Clear stored report
                }

                // --- Event Listeners for File Upload ---
                fileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        handleFile(file);
                    }
                });

                uploadArea.addEventListener('dragover', (event) => {
                    event.preventDefault();
                    uploadArea.classList.add('active-drag');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('active-drag');
                });

                uploadArea.addEventListener('drop', (event) => {
                    event.preventDefault();
                    uploadArea.classList.remove('active-drag');
                    const file = event.dataTransfer.files[0];
                    if (file) {
                        handleFile(file);
                    }
                });

                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });

                // --- File Processing and Preview ---
                function handleFile(file) {
                    if (file.type.startsWith('image/') && file.size <= 5 * 1024 * 1024) {
                        uploadedFile = file;
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            previewImage.src = e.target.result;
                            // Store the base64 string, removing the "data:image/jpeg;base64," prefix
                            uploadedImageBase64 = e.target.result.split(',')[1];

                            imagePreview.style.display = 'block';
                            analyzeBtn.style.display = 'block';
                            resultContainer.style.display = 'none';
                            loadingIndicator.style.display = 'none';
                            downloadReportBtn.style.display = 'none'; // Hide download button
                            llmInsightsContainer.style.display = 'none'; // Hide LLM insights container
                            llmInsightsContent.innerHTML = ''; // Clear LLM content
                            resultBox.textContent = 'Ready for Analysis...';
                            resultBox.className = 'result-box';
                            confidenceLevel.style.width = '0%';
                            confidenceLevel.style.backgroundColor = '';
                            confidenceValue.textContent = 'Confidence: --%';
                            resultExplanation.textContent = "Click 'Initiate Analysis' to begin.";
                            fullAnalysisReport = ''; // Clear stored report
                        };
                        reader.readAsDataURL(file);
                    } else {
                        displayMessageBox('Invalid File', 'Please upload an image file (JPG, PNG) smaller than 5MB.');
                        resetDetectionUI();
                    }
                }

                // --- Analyze Button Click Handler (Gemini API) ---
                analyzeBtn.addEventListener('click', async () => {
                    if (!uploadedFile) {
                        displayMessageBox('No Image', 'Please upload an image first.');
                        return;
                    }

                    // Update UI to show analysis in progress
                    resultBox.textContent = 'Analyzing...';
                    resultBox.className = 'result-box';
                    resultContainer.style.display = 'block';
                    loadingIndicator.style.display = 'flex';
                    loadingIndicator.querySelector('p').textContent = 'Sending image to AI for comprehensive analysis...';
                    confidenceLevel.style.width = '0%';
                    confidenceLevel.style.backgroundColor = '';
                    confidenceValue.textContent = 'Confidence: --%';
                    resultExplanation.textContent = "AI is processing the image for deepfake indicators, including faces and background details.";
                    analyzeBtn.disabled = true;
                    downloadReportBtn.style.display = 'none'; // Hide download button during analysis
                    llmInsightsContainer.style.display = 'none'; // Hide LLM insights container
                    llmInsightsContent.innerHTML = ''; // Clear LLM content
                    fullAnalysisReport = ''; // Clear stored report

                    // Construct a detailed prompt for the LLM to perform deepfake analysis
                    const prompt = `
                        You are an advanced AI trained to analyze images for signs of deepfake manipulation.
                        Examine the provided image carefully and provide a simulated, detailed analysis report.
                        Your report should cover the following aspects:

                        **1. Overall Image Cohesion:**
                        - Does the image look natural and consistent as a whole?
                        - Are there any general inconsistencies in resolution, sharpness, or grain across different parts of the image?

                        **2. Face Analysis (if faces are present):**
                        - Are facial features (eyes, nose, mouth, ears) natural in their appearance and proportion?
                        - Is the skin texture consistent, or are there areas that appear too smooth, too grainy, or unnaturally blurred/sharp?
                        - Are there any odd blurs, pixelations, or unnatural lighting on faces?
                        - Do the eyes appear natural (e.g., consistent reflections, natural gaze, realistic blinks if applicable)?
                        - Is the head pose and facial expression consistent with the body and overall scene?

                        **3. Background Analysis:**
                        - Does the background appear natural and consistent with the foreground subject(s)?
                        - Are there any strange distortions, repetitions, or inconsistencies in the background elements (e.g., repeating patterns, unnatural straight lines, warped objects)?
                        - Is the depth of field and focus consistent between the foreground and background?

                        **4. Lighting and Shadows Consistency:**
                        - Are the lighting conditions consistent across the entire image (e.g., light source direction, intensity, color)?
                        - Are shadows realistic and consistent with the light source and object positions? Are there any missing or unnatural shadows?

                        **5. Digital Artifacts and Anomalies:**
                        - Are there any subtle digital artifacts, noise patterns, or strange edges that might indicate AI generation (e.g., compression artifacts, GAN-specific textures, blending issues)?
                        - Look for pixel-level irregularities that might not be visible to the naked eye but can be indicative of manipulation.

                        **Conclusion:**
                        Based on your comprehensive analysis, state clearly whether the image *appears* to be "Real" or "Potentially Fake". Provide a brief, concise reason for your conclusion, referencing your observations above.
                        Finally, provide a simulated "Confidence Score" as a percentage (e.g., "Confidence: 95% Real" or "Confidence: 88% Fake").

                        Format your response clearly with headings for each section.
                    `;

                    let chatHistory = [];
                    chatHistory.push({
                        role: "user",
                        parts: [
                            { text: prompt },
                            {
                                inlineData: {
                                    mimeType: uploadedFile.type, // Use the actual mime type of the uploaded file
                                    data: uploadedImageBase64
                                }
                            }
                        ]
                    });

                    const payload = { contents: chatHistory };
                    const apiKey = ""; // Leave as-is, Canvas will provide in runtime
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        // Check if the response itself indicates an error (e.g., 4xx or 5xx status)
                        if (!response.ok) {
                            const errorData = await response.json();
                            console.error('API Error Response:', errorData);
                            throw new Error(`API call failed with status ${response.status}: ${errorData.error.message || 'Unknown error'}`);
                        }

                        const result = await response.json();
                        console.log('Gemini API raw response received:', result);

                        // Robustly check for the expected structure
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0 &&
                            result.candidates[0].content.parts[0].text) {

                            const aiResponseText = result.candidates[0].content.parts[0].text;
                            fullAnalysisReport = aiResponseText; // Store the full report

                            // Extract verdict and confidence from the AI response for display
                            const verdictMatch = aiResponseText.match(/Conclusion:\s*(Real|Potentially Fake)/i);
                            const confidenceMatch = aiResponseText.match(/Confidence:\s*(\d+)%/i);

                            let simulatedResult = 'Uncertain';
                            let simulatedConfidence = 0;

                            if (verdictMatch && verdictMatch[1]) {
                                simulatedResult = verdictMatch[1];
                            }
                            if (confidenceMatch && confidenceMatch[1]) {
                                simulatedConfidence = parseInt(confidenceMatch[1]);
                            } else {
                                // If confidence not explicitly found, derive a random one based on verdict
                                if (simulatedResult.toLowerCase().includes('real')) {
                                    simulatedConfidence = Math.floor(Math.random() * 20) + 80; // 80-99% real
                                } else if (simulatedResult.toLowerCase().includes('fake')) {
                                    simulatedConfidence = Math.floor(Math.random() * 20) + 80; // 80-99% fake
                                } else {
                                    simulatedConfidence = Math.floor(Math.random() * 30) + 60; // 60-89% uncertain
                                }
                            }

                            // Update UI with AI prediction result
                            resultBox.textContent = `Verdict: ${simulatedResult}`;
                            resultBox.classList.remove('real', 'fake');
                            if (simulatedResult.toLowerCase().includes('fake')) {
                                resultBox.classList.add('fake');
                                confidenceLevel.style.backgroundColor = 'var(--accent-danger)';
                            } else if (simulatedResult.toLowerCase().includes('real')) {
                                resultBox.classList.add('real');
                                confidenceLevel.style.backgroundColor = 'var(--accent-tertiary)';
                            } else {
                                // Default color if uncertain
                                confidenceLevel.style.backgroundColor = 'var(--accent-secondary)';
                            }

                            setTimeout(() => {
                                confidenceLevel.style.width = `${simulatedConfidence}%`;
                            }, 100);
                            confidenceValue.textContent = `Confidence: ${simulatedConfidence}%`;

                            llmInsightsContent.innerHTML = aiResponseText.replace(/\n/g, '<br>'); // Display full AI text
                            llmInsightsContainer.style.display = 'block'; // Show LLM insights container
                            resultExplanation.textContent = "See the detailed AI analysis above.";
                            downloadReportBtn.style.display = 'block'; // Show download button

                        } else {
                            // Handle cases where the response structure is unexpected or content is missing
                            llmInsightsContent.textContent = "Could not generate insights. The AI response was empty or malformed.";
                            llmInsightsContainer.style.display = 'block';
                            resultExplanation.textContent = "An error occurred during AI analysis. Please try again.";
                            console.error("Unexpected Gemini API response structure:", result);
                            displayMessageBox('AI Response Error', 'The AI returned an unexpected or empty response. Please try again with a different image.');
                        }
                    } catch (error) {
                        console.error('Error during Gemini API call:', error);
                        resultBox.textContent = 'Analysis Failed';
                        resultBox.classList.remove('real', 'fake');
                        resultBox.classList.add('fake');
                        confidenceLevel.style.width = '0%';
                        confidenceValue.textContent = 'Confidence: --%';
                        resultExplanation.textContent = `An error occurred during AI analysis: ${error.message}. This might be a network issue or a problem with the AI service. Please try again.`;
                        llmInsightsContainer.style.display = 'none'; // Hide insights on error
                        displayMessageBox('Analysis Error', `Failed to perform analysis: ${error.message}. Please check your internet connection and try again.`);
                    } finally {
                        analyzeBtn.disabled = false;
                        loadingIndicator.style.display = 'none';
                        console.log('Analysis process finished.');
                    }
                });

                // --- Download Report Button Handler ---
                downloadReportBtn.addEventListener('click', () => {
                    if (fullAnalysisReport) {
                        const blob = new Blob([fullAnalysisReport], { type: 'text/plain' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'deepfake_analysis_report.txt';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url); // Clean up the URL object
                    } else {
                        displayMessageBox('No Report', 'No analysis report available to download. Please perform an analysis first.');
                    }
                });

            } catch (initError) {
                console.error('Error during window.onload initialization:', initError);
                displayMessageBox('Initialization Error', 'An unexpected error occurred during page setup. Please refresh. Error: ' + initError.message);
            }
        };
    </script>
</body>
</html>
